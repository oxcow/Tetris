function createElement(a,b,c){a=document.createElement(a);null!=b&&a.setAttribute("id",b);null!=c&&a.appendChild(document.createTextNode(c));return a}function RandomEventUtils(){}RandomEventUtils.getIntRandomNumFromZeroToN=function(a){a*=Math.random();return Math.round(a)};Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(a==this[b])return b;return-1};Array.prototype._length=function(){for(var a=0,b=0;b<this.length;b++)void 0!=this[b]&&a++;return a};
Array.prototype.cleanUndefinedElement=function(){for(var a=0;a<this.length;a++)void 0==this[a]&&this.splice(a--,1);return this};function createTwoDimensionArray(a){for(var b=Array(a),c=0;c<a;c++)b[c]=[];return b}function elementGroupByN(a,b){for(var c=createTwoDimensionArray(20,[]),d=0;d<a.length;d++)c[Math.floor((a[d]-1)/b)][(a[d]-1)%b]=a[d];return c}function Canvas(a,b,c){this.row=a;this.column=b;this.offset=c}
Canvas.prototype.draw=function(){var a=document.getElementById(this.offset);null==a&&(a=createElement("div",this.offset,null),document.body.appendChild(a));for(var b=document.createDocumentFragment(),c=1;c<=this.row*this.column;c++){var d=createElement("span",c,null);b.appendChild(d)}a.appendChild(b)};function PreCanvas(a,b,c){this.row=a;this.column=b;this.offset=c}
PreCanvas.prototype.draw=function(){var a=document.getElementById(this.offset);null==a&&(a=createElement("div",this.offset,null),document.body.appendChild(a));for(var b=document.createDocumentFragment(),c=-(this.row*this.column)+11;11>c;c++){var d=createElement("span","pre_"+c,null);b.appendChild(d)}a.appendChild(b)};
PreCanvas.prototype.show=function(a){for(var b=-(this.row*this.column)+11;11>b;b++){var c=document.getElementById("pre_"+b);c&&(c.style.background=document.getElementById(this.offset).style.background)}for(b=0;b<a.length;b++)if(c=document.getElementById("pre_"+a[b]))c.style.background="blue"};function Tetris(a,b){this.axis=a;this.body=b}Tetris.column=10;
Tetris.Factory=function(){var a=null,a=90*RandomEventUtils.getIntRandomNumFromZeroToN(4);switch(RandomEventUtils.getIntRandomNumFromZeroToN(9)){case 0:case 8:a=new I_Tetris(-15,a);break;case 1:a=new O_Tetris(-15);break;case 2:case 7:a=new S_Tetris(-15,a);break;case 3:a=new L_Tetris(-15,a);break;case 4:a=new Z_Tetris(-15,a);break;case 5:a=new T_Tetris(-15,a);break;case 6:a=new J_Tetris(-15,a);break;default:a=new T_Tetris(-15,a)}return a};
Tetris.prototype.draw=function(){for(var a=0;a<this.body.length;a++){var b=document.getElementById(this.body[a]);b&&(b.style.background="#135")}};Tetris.prototype.eraser=function(){for(var a=0;a<this.body.length;a++){var b=document.getElementById(this.body[a]);b&&(b.style.background=document.getElementById("canvas").style.background)}};
Tetris.prototype.rotateTune=function(a){this.body=a;if(1==this.axis%Tetris.column){for(a=0;a<this.body.length;a++)this.body[a]++;this.axis++}if(0==this.axis%Tetris.column){for(a=0;a<this.body.length;a++)this.body[a]-=2;this.axis-=1}};Tetris.prototype.move=function(a){this.eraser();for(var b=0;b<this.body.length;b++)this.body[b]+=a;this.axis+=a;this.draw()};function O_Tetris(a){Tetris.call(this,a,[+a-1,+a,+a+Tetris.column-1,+a+Tetris.column])}O_Tetris.prototype=new Tetris;
O_Tetris.prototype.rotate=function(){};function I_Tetris(a,b){Tetris.call(this,a,I_Tetris.newITetrisBody(a,b));this.iAngle=b}I_Tetris.newITetrisBody=function(a,b){var c=null;switch(b){case 0:case 180:case 360:a=0==a%10?a-=2:9==a%10?a-=1:a;c=[a-1,a,a+1,a+2];break;case 90:case 270:c=[a-Tetris.column,a,a+Tetris.column,a+2*Tetris.column];break;default:c=[a-1,a,a+1,a+2]}return c};I_Tetris.prototype=new Tetris;
I_Tetris.prototype.rotate=function(){this.iAngle=360==this.iAngle?90:this.iAngle+90;this.rotateTune(I_Tetris.newITetrisBody(this.axis,this.iAngle))};function L_Tetris(a,b){Tetris.call(this,a,L_Tetris.newLTetrisBody(a,b));this.iAngle=b}
L_Tetris.newLTetrisBody=function(a,b){var c=null;switch(b){case 0:case 360:c=[a-Tetris.column,a,a+Tetris.column,a+Tetris.column+1];break;case 90:c=[a+1,a,a-1,a+Tetris.column-1];break;case 180:c=[a+Tetris.column,a,a-Tetris.column,a-Tetris.column-1];break;case 270:c=[a-1,a,a+1,a-Tetris.column+1];break;default:c=[a-Tetris.column,a,a+Tetris.column,a+Tetris.column+1]}return c};L_Tetris.prototype=new Tetris;
L_Tetris.prototype.rotate=function(){this.iAngle=360==this.iAngle?90:this.iAngle+90;this.rotateTune(L_Tetris.newLTetrisBody(this.axis,this.iAngle))};function J_Tetris(a,b){Tetris.call(this,a,J_Tetris.newJTetrisBody(a,b));this.iAngle=b}
J_Tetris.newJTetrisBody=function(a,b){var c=null;switch(b){case 0:case 360:c=[a-Tetris.column,a,a+Tetris.column,a+Tetris.column-1];break;case 90:c=[a+1,a,a-1,a-Tetris.column-1];break;case 180:c=[a+Tetris.column,a,a-Tetris.column,a-Tetris.column+1];break;case 270:c=[a-1,a,a+1,a+Tetris.column+1];break;default:c=[a-Tetris.column,a,a+Tetris.column,a+Tetris.column-1]}return c};J_Tetris.prototype=new Tetris;
J_Tetris.prototype.rotate=function(){this.iAngle=360==this.iAngle?90:this.iAngle+90;this.rotateTune(J_Tetris.newJTetrisBody(this.axis,this.iAngle))};function T_Tetris(a,b){Tetris.call(this,a,T_Tetris.newTTetrisBody(a,b));this.iAngle=b}
T_Tetris.newTTetrisBody=function(a,b){var c=null;switch(b){case 0:case 360:c=[a-1,a,a+1,a+Tetris.column];break;case 90:c=[a-Tetris.column,a,a+Tetris.column,a-1];break;case 180:c=[a+1,a,a-1,a-Tetris.column];break;case 270:c=[a+Tetris.column,a,a-Tetris.column,a+1];break;default:c=[a-1,a,a+1,a+Tetris.column]}return c};T_Tetris.prototype=new Tetris;T_Tetris.prototype.rotate=function(){this.iAngle=360==this.iAngle?90:this.iAngle+90;this.rotateTune(T_Tetris.newTTetrisBody(this.axis,this.iAngle))};
function S_Tetris(a,b){Tetris.call(this,a,S_Tetris.newSTetrisBody(a,b));this.iAngle=b}S_Tetris.newSTetrisBody=function(a,b){var c=null;switch(b){case 0:case 180:case 360:c=[a+1,a,a+Tetris.column,a+Tetris.column-1];break;case 90:case 270:c=[a-Tetris.column,a,a+1,a+Tetris.column+1];break;default:c=[a+1,a,a+Tetris.column,a+Tetris.column-1]}return c};S_Tetris.prototype=new Tetris;
S_Tetris.prototype.rotate=function(){this.iAngle=360==this.iAngle?90:this.iAngle+90;this.rotateTune(S_Tetris.newSTetrisBody(this.axis,this.iAngle))};function Z_Tetris(a,b){Tetris.call(this,a,Z_Tetris.newZTetrisBody(a,b));this.iAngle=b}Z_Tetris.newZTetrisBody=function(a,b){var c=null;switch(b){case 0:case 180:case 360:c=[a-1,a,a+Tetris.column,a+Tetris.column+1];break;case 90:case 270:c=[a-Tetris.column,a,a-1,a+Tetris.column-1];break;default:c=[a-1,a,a+Tetris.column,a+Tetris.column+1]}return c};
Z_Tetris.prototype=new Tetris;Z_Tetris.prototype.rotate=function(){this.iAngle=360==this.iAngle?90:this.iAngle+90;this.rotateTune(Z_Tetris.newZTetrisBody(this.axis,this.iAngle))};function TetrisGame(){this.timeOut;this.level=this.score=0;this.speed=1E3;this.canvas=new Canvas(20,10,"canvas");this.preCanvas=new PreCanvas(10,4,"preCanvas");this.tetris=null;this.preTetris=Tetris.Factory();this.body=[]}
TetrisGame.prototype.preload=function(){this.displayScoreAndLevel();this.canvas.draw();this.preCanvas.draw();this.preCanvas.show(this.preTetris.body)};TetrisGame.prototype.newTetris=function(){this.tetris=this.preTetris;this.preTetris=Tetris.Factory();this.preCanvas.show(this.preTetris.body)};
TetrisGame.prototype.__eraserRow=function(){var a=0;this.body.sort(function(a,b){return a-b});for(var b=elementGroupByN(this.body,10),c=[],d=0;d<b.length;d++)0!=b[d]._length()&&(10!=b[d]._length()?c=c.concat(b[d]):10==b[d]._length()&&(this.body.splice(this.body.indexOf(10*d+1),10),this.tetris.body=b[d],this.tetris.eraser(),0!=c.length&&(this.tetris.body=c.cleanUndefinedElement(),this.body.splice(0,this.tetris.body.length),this.tetris.move(10),this.body=this.tetris.body.concat(this.body)),a++));return a};
TetrisGame.prototype.touchHandler=function(){this.tetris.body.sort();for(var a=0;4>a;a++){if((0>this.tetris.body[0]||1==Math.floor(this.tetris.body[a]/10))&&-1!=this.body.indexOf(this.tetris.body[a]+10))alert("GAME OVER"),location.reload();if(-1!=this.body.indexOf(this.tetris.body[a]+10))return this.body=this.body.concat(this.tetris.body),this.scoreAndLevelHandler(this.__eraserRow()),!0}return 19==Math.floor((this.tetris.body[3]-1)/10)?(this.body=this.body.concat(this.tetris.body),this.scoreAndLevelHandler(this.__eraserRow()),
!0):!1};TetrisGame.prototype.rotateHandler=function(){var a=this.tetris.body,b=this.tetris.iAngle;this.tetris.eraser();this.tetris.rotate();for(var c=0;c<this.tetris.body.length;c++)if(-1!=this.body.indexOf(this.tetris.body[c])){this.tetris.iAngle=b;this.tetris.body=a;break}this.tetris.draw()};
TetrisGame.prototype.scoreAndLevelHandler=function(a){this.score+=10;0!=a&&(this.score+=100*Math.pow(2,a-1));this.level=Math.floor(this.score/400);130<this.speed&&(this.speed=1E3-80*Math.floor(this.level/3));this.displayScoreAndLevel()};TetrisGame.prototype.displayScoreAndLevel=function(){document.getElementById("score").innerHTML=this.score;document.getElementById("level").innerHTML=this.level};
TetrisGame.prototype.leftOrRightMove=function(a){for(var b=0;4>b;b++)if("left"==a){if(1==this.tetris.body[b]%10&&0==(this.tetris.body[b]-1)%10||-1!=this.body.indexOf(this.tetris.body[b]-1))return!0}else if("right"==a){if(0==this.tetris.body[b]%10&&1==(this.tetris.body[b]+1)%10||-1!=this.body.indexOf(this.tetris.body[b]+1))return!0}else break;return!1};
TetrisGame.prototype.keyboardEventsListeners=function(a){var b=null;window.event?b=window.event.keyCode:a.which&&(b=a.which);37==b&&(this.leftOrRightMove("left")||this.tetris.move(-1));39==b&&(this.leftOrRightMove("right")||this.tetris.move(1));38==b&&this.rotateHandler();40==b&&(this.touchHandler()&&this.newTetris(),this.tetris.move(10))};TetrisGame.prototype.__delay=function(a,b,c){fnGameDelay=function(){b.call(a)};return setTimeout("fnGameDelay()",c)};
TetrisGame.prototype.start=function(){(null==this.tetris||this.touchHandler())&&this.newTetris();this.tetris.move(10);this.timeOut=this.__delay(this,this.start,this.speed)};TetrisGame.prototype.stop=function(){clearTimeout(this.timeOut)};TetrisGame.prototype.restart=function(){location.reload()};
window.onload=function(){var a=new TetrisGame;a.preload();document.onkeydown=function(b){a.keyboardEventsListeners.call(a,b)};document.getElementById("start").onclick=function(){a.start.call(a)};document.getElementById("stop").onclick=function(){a.stop.call(a)};document.getElementById("restart").onclick=function(){a.restart.call(a)}};
